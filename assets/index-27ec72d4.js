var ie=Object.defineProperty;var re=(a,e,t)=>e in a?ie(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var r=(a,e,t)=>(re(a,typeof e!="symbol"?e+"":e,t),t);import{T as S,S as D,M as $,a as E,U as ae,b as q,B as oe,A as V,G as P,C as W,D as ne,P as le,F as m,c as N,d as de,L as he,e as ce,f as ue,g as H,h as pe,W as fe,O as ge,R as Se,V as me}from"./vendor-6836e39f.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class we{constructor(){r(this,"baseUrl","");r(this,"basePath","/StuffInSpace/images");r(this,"radiusInKm",6371);r(this,"pxToRadius",3185.5);r(this,"addAtmosphere",!1);r(this,"addClouds",!0);r(this,"sphere");r(this,"group")}initClouds(e,t){const s=new S().load(`${this.basePath}/Earth_Cloud.jpg`),i=e.km2pixels(this.radiusInKm+.02),n=new D(i,32,32),o=new $({map:s,opacity:.3,transparent:!0}),d=new E(n,o),l=1.01;d.scale.set(l,l,l),t.add(d)}initAtmosphere(e,t){const s=["varying vec3 vNormal;","varying vec3 vPosition;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vPosition = gl_Position.xyz;","}"].join(`
`),i=["varying vec3 vNormal;","varying vec3 vPosition;","void main() {","  float intensity = pow( 0.8 + dot( vNormal, vec3( 0, 0, 1.0 ) ), 12.0 );","  intensity = min(intensity, 1.7);","  gl_FragColor = vec4( 0.37, 0.71, 0.93, 0.6 ) * intensity;","}"].join(`
`),n=ae.clone({}),o=new q({uniforms:n,vertexShader:s,fragmentShader:i,side:oe,blending:V,transparent:!0}),d=e.km2pixels(this.radiusInKm+.1),l=new D(d,32,32),h=new E(l,o),u=1.019;h.scale.set(u,u,u),t.add(h)}init(e,t){t.config&&(this.baseUrl=t.config.baseUrl),this.group=new P;const s=`${this.baseUrl}/images`,i=new S().load(`${s}/earth-blue-marble.jpg`),n=new S().load(`${s}/nightearth-4096.png`),o=new S().load(`${s}/8081_earthbump4k.jpg`),d=new S().load(`${s}/earth-water.png`),l=new $({map:i,bumpMap:o,emissiveMap:n,emissive:new W(8947848),emissiveIntensity:5,specularMap:d,specular:1,shininess:15,bumpScale:1}),h=e.km2pixels(this.radiusInKm),u=new D(h,32,32);this.sphere=new E(u,l),this.group.add(this.sphere),this.addClouds&&this.initClouds(e,this.group),this.addAtmosphere&&this.initAtmosphere(e,this.group),e.add(this.group)}update(){}getMesh(){return this.sphere}}const G=class G{constructor(){r(this,"fastTime",!1);r(this,"showGeometry",!1);r(this,"lightSouce");r(this,"lightSourceGeometery");r(this,"hour",0);r(this,"objectGroup");r(this,"scene");r(this,"visible",!0)}degreesToReadians(e){return e*G.deg2RadMult}calculateSunLoc(){let t=this.hour;(t===void 0||t===-1)&&(t=ne.utc().hour);const s=t/24*360+180;return{x:25*Math.cos(this.degreesToReadians(s)),z:25*Math.sin(this.degreesToReadians(s))}}init(e){this.fastTime?setInterval(()=>{this.hour+=.05},100):this.hour=-1,this.calculateSunLoc();const t=this.calculateSunLoc(),s={x:t.x,y:0,z:t.z};if(this.scene=e,this.objectGroup=new P,this.lightSouce=new le(16777215,2e3),this.lightSouce.position.set(s.x,s.y,s.z),this.objectGroup.add(this.lightSouce),this.showGeometry){const i=new D(.1,32,32);this.lightSourceGeometery=new E(i),this.lightSourceGeometery.position.set(s.x,s.y,s.z),this.objectGroup.add(this.lightSourceGeometery)}e.add(this.objectGroup)}update(){}setVisible(e){var t,s;e?this.visible||(t=this.scene)==null||t.add(this.objectGroup):this.visible&&((s=this.scene)==null||s.remove(this.objectGroup)),this.visible=e}};r(G,"deg2RadMult",Math.PI/180);let O=G;class ye{init(e){const t=new S().load("textures/example_render.jpg");e.background=t}update(){}}function ve(){return new Worker("/StuffInSpace/assets/SatCruncherWorker-3c37ad1c.js")}const be="/StuffInSpace",J={appName:"Stuff in Space",baseUrl:be,propergateInterval:1e3,pushHistory:!1,logLevel:"debug",satelliteGroups:[{id:"GPSGroup",name:"GPS",groupType:"intlDes",data:["90103A","93068A","96041A","97035A","99055A","00025A","00040A","00071A","01004A","03005A","03010A","03058A","04009A","04023A","04045A","05038A","06042A","06052A","07047A","07062A","08012A","09043A","10022A","11036A","12053A","13023A","14008A","14026A","14045A","14068A","15013A"]},{id:"IridiumGroup",name:"Iridium Debris",groupType:"nameRegex",data:/IRIDIUM(?!.*DEB)/},{id:"Iridium33DebrisGroup",name:"Iridium 33 Debris",groupType:"nameRegex",data:/(COSMOS 2251|IRIDIUM 33) DEB/},{id:"GlonassGroup",name:"Glonass",groupType:"nameRegex",data:/GLONASS/},{id:"GalileoGroup",name:"Galileo",groupType:"nameRegex",data:/GALILEO/},{id:"FunGroup",name:"Fun",groupType:"nameRegex",data:/SYLDA/},{id:"WestfordNeedlesGroup",name:"Westford Needles",groupType:"nameRegex",data:/WESTFORD NEEDLES/},{id:"SpaceXGroup",name:"Space X",groupType:"nameRegex",data:/FALCON [19]/},{id:"DebrisGroup",name:"Debris",groupType:"objectType",data:"DEBRIS"},{id:"Starlink",name:"Starlink",groupType:"nameRegex",data:/STARLINK/},{id:"Unknown",name:"Unknown Objects",groupType:"objectType",data:"UNKNOWN"}]},x=["error","warn","info","debug"],y={};let b={};function L(a,e,t,...s){a.enabledOutputs[e]&&t(e.toUpperCase(),...s)}function _(a){const e=x.indexOf(a.toLowerCase());if(e<0)throw new Error("Unknown log level");for(let t=0;t<x.length;t++)y[x[t]]=t<=e}function xe(){return{error:b.error,warn:b.warn,info:b.info,debug:b.debug,setLogLevel:_}}function Le(){b={error:L.bind(this,{enabledOutputs:y},"error",console.error),warn:L.bind(this,{enabledOutputs:y},"warn",console.warn),info:L.bind(this,{enabledOutputs:y},"info",console.info),debug:L.bind(this,{enabledOutputs:y},"debug",console.debug)};for(let a=0;a<x.length;a++)y[x[a]]=!0}Le();_(J.logLevel);const p=xe();class De{constructor(e,t){r(this,"name");r(this,"colorizer");this.name=e,this.colorizer=t}getSatelliteColor(e){return this.colorizer(e)}}class Ee extends De{constructor(){super("Default color scheme",e=>{let t=[1,1,0,1],s=!1;return e&&(s=!0,e.OBJECT_TYPE==="PAYLOAD"?t=[1,.2,0,1]:e.OBJECT_TYPE==="ROCKET BODY"?t=[.2,.5,1,.85]:e.OBJECT_TYPE==="DEBRIS"&&(t=[.5,.5,.5,.85])),{color:t,pickable:s}})}}class Ge{constructor(){r(this,"baseUrl","");r(this,"worker");r(this,"currentColorScheme",new Ee);r(this,"numSats",1);r(this,"maxSize",0);r(this,"satPos",new Float32Array);r(this,"satVel",new Float32Array);r(this,"satAlt",new Float32Array);r(this,"cruncherReady",!1);r(this,"scene");r(this,"particles");r(this,"geometry");r(this,"satelliteStore");r(this,"shaderStore");r(this,"selectedSatelliteIdx",-1);r(this,"hoverSatelliteIdx",-1)}setColorScheme(e){this.currentColorScheme=e}updateSatellites(){var e,t;if(this.satPos&&this.satPos.length>0&&this.geometry&&this.geometry.attributes&&(this.geometry.attributes.position&&this.geometry.setAttribute("position",new m(this.satPos,3)),this.geometry.attributes.color&&this.currentColorScheme)){const s=[];if(!this.satelliteStore)return;const i=this.satelliteStore.satData;for(let n=0;n<i.length;n++){const o=((t=(e=this.currentColorScheme)==null?void 0:e.getSatelliteColor(i[n]))==null?void 0:t.color)||[0,0,0];s.push(o[0],o[1],o[2],o[3])}this.geometry.setAttribute("color",new m(s,4))}}onMessage(e){var i;if(!this.satelliteStore)return;const t=this.satelliteStore.getSatData();if(!t)return;let s;try{if(!this.satelliteStore.gotExtraData){const n=performance.now();if(e.data.extraData){if(s=JSON.parse(e.data.extraData),!s)return;for(let o=0;o<this.numSats;o++)t[o].inclination=s[o].inclination,t[o].eccentricity=s[o].eccentricity,t[o].raan=s[o].raan,t[o].argPe=s[o].argPe,t[o].meanMotion=s[o].meanMotion,t[o].semiMajorAxis=s[o].semiMajorAxis,t[o].semiMinorAxis=s[o].semiMinorAxis,t[o].apogee=s[o].apogee,t[o].perigee=s[o].perigee,t[o].period=s[o].period;this.satelliteStore.setSatelliteData(t),p.debug(`sat.js copied extra data in ${performance.now()-n} ms`),this.satelliteStore.setSatelliteData(t,!0);return}}this.satPos=new Float32Array(e.data.satPos),this.satVel=new Float32Array(e.data.satVel),this.satAlt=new Float32Array(e.data.satAlt),this.satelliteStore.setPositionalData(this.satVel,this.satPos,this.satAlt),this.cruncherReady||((i=document.querySelector("#load-cover"))==null||i.classList.add("hidden"),this.cruncherReady=!0),this.updateSatellites()}catch(n){p.debug("Error in worker response",n),p.debug("worker message",e)}}onSatDataLoaded(){if(this.satelliteStore)if(this.worker){const e=JSON.stringify(this.satelliteStore.satData);p.debug("Sending data to sat cruncher worker, to perform work"),this.worker.postMessage(e)}else p.error("worker is not available")}setSelectedSatellite(e){this.selectedSatelliteIdx=e}setHoverSatellite(e){this.hoverSatelliteIdx=e}initGeometry(){if(!this.satelliteStore)throw new Error("satelliteStore is not available");if(!this.shaderStore)throw new Error("sahderStore is not available");const e=new N,t=new Float32Array,s=new Float32Array,i=[];t.fill(0,0,this.satelliteStore.satData.length*3),i.fill(0,0,this.satelliteStore.satData.length*3),s.fill(10,0,this.satelliteStore.satData.length),e.setAttribute("position",new m(t,3)),e.setAttribute("color",new m(i,4)),e.setAttribute("size",new m(s,1));const n=new S().load(`${this.baseUrl}/images/circle.png`),o=this.shaderStore.getShader("dot2"),d=new q({uniforms:{color:{value:new W(16777215)},pointTexture:{value:n}},clipping:!0,vertexShader:o.vertex,fragmentShader:o.fragment,blending:V,depthTest:!0,transparent:!0});this.geometry=e,this.particles=new de(e,d),this.scene&&this.scene.add(this.particles)}async init(e,t){this.satelliteStore=t.satelliteStore,this.shaderStore=t.shaderStore,this.scene=e,p.info("Kicking off sat-cruncher-worker"),this.worker=new ve,this.worker.onmessage=this.onMessage.bind(this),t!=null&&t.config&&(this.baseUrl=t.config.baseUrl),this.satelliteStore&&(this.satelliteStore.addEventListener("satdataloaded",this.onSatDataLoaded.bind(this)),await this.satelliteStore.loadSatelliteData(),this.initGeometry(),this.satelliteStore.gotExtraData&&this.updateSatellites())}update(){}}function Te(){return new Worker("/StuffInSpace/assets/OrbitCalculationWorker-b9f56d15.js")}class Ie{constructor(){r(this,"segmentCount",255);r(this,"orbitWorker");r(this,"selectedSatelliteIdx",-1);r(this,"hoverSatelliteIdx",-1);r(this,"satelliteGroups");r(this,"satelliteGroup");r(this,"inProgress",[]);r(this,"scene");r(this,"selectColor",[0,1,0,1]);r(this,"hoverColor",[.5,.5,1,1]);r(this,"groupColor",[.3,.5,1,.4]);r(this,"orbitTracks",[]);r(this,"satelliteStore");r(this,"satelliteOrbitGroup")}calculateOrbits(e){e=e.filter(t=>!this.inProgress[t]),this.orbitWorker?this.orbitWorker.postMessage({isInit:!1,satId:e}):p.error("Orbit worker is undefined"),e.forEach(t=>this.inProgress[t]=!0)}onSatellitesLoaded(){this.satelliteStore&&(this.inProgress=new Array(this.satelliteStore.size()),this.orbitTracks=new Array(this.satelliteStore.size()),this.orbitWorker&&this.orbitWorker.postMessage({isInit:!0,satData:JSON.stringify(this.satelliteStore.satData),numSegs:this.segmentCount}))}updateOrbitTrack(e){if(this.orbitTracks[e]){const s=this.orbitTracks[e].material;s.color=this.getTrackColor(e),s.needsUpdate=!0}}removeOrbitTrack(e){var t;if(this.orbitTracks[e]){const s=this.orbitTracks[e];(t=this.satelliteOrbitGroup)==null||t.remove(s),s.geometry&&s.geometry.dispose(),this.orbitTracks[e]=void 0}}getTrackColor(e){let t=[0,0,9];return e===this.hoverSatelliteIdx?t=this.hoverColor:e===this.selectedSatelliteIdx?t=this.selectColor:this.satelliteGroup&&this.satelliteGroup.hasSat(e)&&(t=this.groupColor),new W(t[0],t[1],t[2])}onMessage(e){const{satId:t}=e.data;if(this.scene)if(this.orbitTracks[t])this.orbitTracks[t].geometry.setAttribute("position",new m(e.data.pointsOut,3)),this.updateOrbitTrack(t);else{const s=this.getTrackColor(t),i=new he({color:s,linewidth:10}),n=new N;n.setAttribute("position",new m(e.data.pointsOut,3));const o=new ce(n,i);this.satelliteOrbitGroup&&this.satelliteOrbitGroup.add(o),this.orbitTracks[t]=o}this.inProgress[t]=!1}setSelectedSatellite(e){this.selectedSatelliteIdx>-1&&(this.orbitTracks[this.selectedSatelliteIdx]&&(!this.satelliteGroup||!this.satelliteGroup.hasSat(this.selectedSatelliteIdx)?this.removeOrbitTrack(this.selectedSatelliteIdx):this.updateOrbitTrack(this.selectedSatelliteIdx)),this.selectedSatelliteIdx=-1),this.selectedSatelliteIdx=e,this.calculateOrbits([e])}setHoverSatellite(e){(this.hoverSatelliteIdx!==void 0&&this.hoverSatelliteIdx>-1||e!==this.hoverSatelliteIdx)&&(!this.satelliteGroup||!this.satelliteGroup.hasSat(this.hoverSatelliteIdx)||this.selectedSatelliteIdx!==this.hoverSatelliteIdx?this.removeOrbitTrack(this.hoverSatelliteIdx):this.updateOrbitTrack(this.hoverSatelliteIdx)),this.hoverSatelliteIdx=e,this.calculateOrbits([e])}setSatelliteGroup(e){if(this.satelliteGroup){this.selectedSatelliteIdx=-1,this.hoverSatelliteIdx=-1;for(let t=0;t<this.orbitTracks.length;t++)this.orbitTracks[t]&&this.removeOrbitTrack(t)}if(this.satelliteGroup=e,this.satelliteGroup){const s=this.satelliteGroup.sats.map(i=>i.satId);this.calculateOrbits(s)}}init(e,t){this.scene=e,this.orbitWorker=new Te,this.orbitWorker.onmessage=this.onMessage.bind(this),this.satelliteStore=t.satelliteStore,this.satelliteStore&&(this.satelliteStore.addEventListener("satdataloaded",this.onSatellitesLoaded.bind(this)),this.satelliteStore.size()>0&&(this.inProgress=new Array(this.satelliteStore.size()),this.onSatellitesLoaded())),t.satelliteGroups&&(this.satelliteGroups=t.satelliteGroups),this.satelliteOrbitGroup=new P,this.scene.add(this.satelliteOrbitGroup)}update(){}}const T=class T extends ue{constructor(){super();r(this,"pxToRadius",3185.5)}setPixels2Radius(t){this.pxToRadius=t}getPixels2Radius(){return this.pxToRadius}km2pixels(t){return t/this.pxToRadius}alitudeToPixels(t){return(T.earthRadiusInKm+t)/this.pxToRadius}};r(T,"earthRadiusInKm",6371);let k=T;class K{constructor(e,t,s,i,n){r(this,"sats",[]);r(this,"id");r(this,"name");r(this,"groupType");r(this,"data");r(this,"satelliteStore");if(this.id=e,this.name=t,this.groupType=s,this.data=i,this.satelliteStore=n,!this.satelliteStore)throw new Error("satelliteStore is required")}reload(){if(this.sats=[],this.groupType==="intlDes")for(let e=0;e<this.data.length;e++)this.sats.push({satId:this.satelliteStore.getIdFromIntlDes(this.data[e]),isIntlDes:!0,strIndex:0});else if(this.groupType==="nameRegex"){const e=this.satelliteStore.searchNameRegex(this.data);for(let t=0;t<e.length;t++)this.sats.push({satId:e[t],isIntlDes:!1,strIndex:0})}else if(this.groupType==="idList")for(let e=0;e<this.data.length;e++)this.sats.push({satId:this.data[e],isIntlDes:!1,strIndex:0});else if(this.groupType==="objectType"){const e="OBJECT_TYPE",t=this.satelliteStore.search({[e]:this.data});for(let s=0;s<t.length;s++)this.sats.push({satId:t[s].id,isIntlDes:!1,strIndex:0})}}getSat(e){return this.satelliteStore.satData.find(t=>t.id===e)}hasSat(e){const t=this.sats.length;for(let s=0;s<t;s++)if(this.sats[s].satId===e)return!0;return!1}}class Ae{constructor(e,t){r(this,"groups",{});r(this,"selectedGroup");r(this,"sats",[]);r(this,"satelliteStore");if(!t)throw new Error("satelliteStore is required");this.satelliteStore=t,this.resetConfig(e),this.satelliteStore.addEventListener("satdataloaded",this.onSatDataLoaded.bind(this))}asArray(){return Object.values(this.groups)}selectGroup(e){if(this.selectedGroup=e,!e){this.clearSelect();return}}forEach(e){for(let t=0;t<this.sats.length;t++)e(this.sats[t].satId)}clearSelect(){this.selectedGroup=void 0}getGroupById(e){if(e)return e=e.toLowerCase(),this.groups[e]}getSelectedGroup(){return this.selectedGroup}reloadGroups(){const e=Object.keys(this.groups);for(let t=0;t<e.length;t++)this.groups[e[t]].reload()}resetConfig(e){const t=e;for(let s=0;s<t.length;s++)p.debug(`registering satellite group ${t[s].name} (id: ${t[s].id})`),this.groups[t[s].id.toLowerCase()]=new K(t[s].id.toLowerCase(),t[s].name,t[s].groupType,t[s].data,this.satelliteStore)}onSatDataLoaded(){this.reloadGroups()}}class Y{constructor(e){r(this,"listeners",{});r(this,"supportedEvents");this.supportedEvents=e}addEventListener(e,t){if(!e)throw new Error("eventName must not be undefined");if(this.supportedEvents&&this.supportedEvents.indexOf(e)<0)throw new Error(`unsupported event ${e}`);if(e=e.toLowerCase(),this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e])this.listeners[e].add(t);else throw new Error("unknown event")}fireEvent(e,t){if(!e)throw new Error("undefined eventName");e=e.toLowerCase(),this.listeners[e]&&this.listeners[e].forEach(i=>{i(t)})}}const Oe={baseUrl:"/StuffInSpace"};class ke{constructor(e={}){r(this,"tleUrl",`${Oe.baseUrl}/data/TLE.json`);r(this,"eventManager");r(this,"satData",[]);r(this,"satelliteVelocities",new Float32Array);r(this,"satellitePositions",new Float32Array);r(this,"satelliteAltitudes",new Float32Array);r(this,"gotExtraData",!1);r(this,"gotPositionalData",!1);r(this,"loaded",!1);this.eventManager=new Y,e.tleUrl&&(this.tleUrl=e.tleUrl)}async loadSatelliteData(){p.debug("Loading satellite data");try{const e=await H.get(this.tleUrl,{params:{t:Date.now()}});if(e.data){this.satData=e.data;for(let t=0;t<this.satData.length;t++){if(this.satData[t].INTLDES){let s=this.satData[t].INTLDES.substring(0,2);s=(s>50?"19":"20")+s;const n=this.satData[t].INTLDES.substring(2);this.satData[t].intlDes=`${s}-${n}`}else this.satData[t].intlDes="unknown";this.satData[t].id=t}}this.eventManager.fireEvent("satdataloaded",this.satData),this.loaded=!0}catch(e){p.error("error loading TLE data",e)}}setSatelliteData(e,t=!1){this.satData=e,this.gotExtraData=t,t&&this.eventManager.fireEvent("satextradataloaded",this.satData)}setPositionalData(e,t,s){this.satelliteVelocities=e,this.satellitePositions=t,this.satelliteAltitudes=s,this.gotPositionalData=!0}getSatData(){return this.satData||[]}getPositions(){return this.satellitePositions}getAltitudes(){return this.satelliteAltitudes}getVelocitities(){return this.satelliteVelocities}size(){return this.satData.length}searchNameRegex(e){const t=[];for(let s=0;s<this.satData.length;s++)e.test(this.satData[s].OBJECT_NAME)&&t.push(s);return t}search(e){const t=Object.keys(e);let s=Object.assign([],this.satData);for(let i=0;i<t.length;i++){const n=t[i];s=s.filter(o=>o[n]===e[n])}return s}searchName(e){const t=[];for(let s=0;s<this.satData.length;s++)this.satData[s].OBJECT_NAME===e&&t.push(s);return t}getIdFromIntlDes(e){for(let t=0;t<this.satData.length;t++)if(this.satData[t].INTLDES===e||this.satData[t].intlDes===e)return t;return null}getSatellite(e){if(!e||e===-1||!this.satData)return;const t=this.satData[e];if(t)return this.gotPositionalData&&(t.altitude=this.satelliteAltitudes[e],t.velocity=Math.sqrt(this.satelliteVelocities[e*3]*this.satelliteVelocities[e*3]+this.satelliteVelocities[e*3+1]*this.satelliteVelocities[e*3+1]+this.satelliteVelocities[e*3+2]*this.satelliteVelocities[e*3+2]),t.position={x:this.satellitePositions[e*3],y:this.satellitePositions[e*3+1],z:this.satellitePositions[e*3+2]}),t}addEventListener(e,t){this.eventManager.addEventListener(e,t)}}class Ce{constructor(e=""){r(this,"baseUrl","/shaders");r(this,"shaders",["earth-fragment","earth-vertex","dot-fragment","dot-vertex","dot2-fragment","dot2-vertex","pick-fragment","pick-vertex","path-fragment","path-vertex"]);r(this,"shaderData",{});this.baseUrl=`${e}${this.baseUrl}`}async loadShader(e){const t=`${this.baseUrl}/${e}.glsl`;p.debug(`loading shader from ${t}`);const s=await H.get(t);if(s.data)return s.data;throw new Error("no data received")}async load(){try{for(let e=0;e<this.shaders.length;e++){const t=await this.loadShader(this.shaders[e]);this.shaderData[this.shaders[e]]=t}}catch(e){p.error("Errors while loading shaders",e)}}addShader(e,t,s){this.shaderData[`${e}-fragment`]=t,this.shaderData[`${e}-vertex`]=s}getFragmentShader(e){return this.shaderData[`${e}-fragment`]}getVertexShader(e){return this.shaderData[`${e}-vertex`]}getShader(e){return{vertex:this.getVertexShader(e),fragment:this.getFragmentShader(e)}}}class Me{constructor(e){r(this,"config",{canvasSelector:".viewer"});r(this,"sceneComponents",[]);r(this,"sceneComponentsByName",{});r(this,"scene");r(this,"camera");r(this,"controls");r(this,"renderer");r(this,"context",{});r(this,"satelliteGroups");r(this,"satelliteStore");r(this,"shaderStore");r(this,"selectedSatelliteIdx",-1);r(this,"eventManager",new Y);r(this,"ready",!1);r(this,"raycaster");r(this,"satellites");r(this,"orbits");this.config={...e,...this.config}}async registerSceneComponent(e,t){this.sceneComponents.push(t),this.sceneComponentsByName[e]=t,await t.init(this.scene,this.context)}onWindowResize(){this.camera&&(this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()),this.renderer&&this.renderer.setSize(window.innerWidth,window.innerHeight)}onSatDataLoaded(e){this.eventManager.fireEvent("satdataloaded",e),this.ready=!0}async init(){var t;this.scene=new k,this.camera=new pe(45,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new fe({antialias:!1}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),(t=document.querySelector(this.config.canvasSelector))==null||t.appendChild(this.renderer.domElement),this.controls=new ge(this.camera,this.renderer.domElement),this.camera.position.set(15,0,1e4),this.controls.update(),this.camera.position.z=5,this.raycaster=new Se,this.satelliteStore=new ke(this.config),this.satelliteGroups=new Ae(this.config.satelliteGroups,this.satelliteStore),this.shaderStore=new Ce(this.config.baseUrl),p.debug("loading shaders"),await this.shaderStore.load(),this.context.satelliteGroups=this.satelliteGroups,this.context.config=this.config,this.context.satelliteStore=this.satelliteStore,this.context.shaderStore=this.shaderStore,this.satelliteStore.addEventListener("satdataloaded",this.onSatDataLoaded.bind(this)),await this.registerSceneComponent("earth",new we),await this.registerSceneComponent("sun",new O),await this.registerSceneComponent("universe",new ye),this.satellites=new Ge,await this.registerSceneComponent("satellites",this.satellites),this.orbits=new Ie,await this.registerSceneComponent("orbits",this.orbits),this.controls.minDistance=4,this.controls.maxDistance=100,window.addEventListener("resize",this.onWindowResize.bind(this));const e=this.renderer.domElement;e.addEventListener("click",s=>{if(!this.raycaster||!this.scene)return;const i=e.getBoundingClientRect(),n=new me;n.x=(s.clientX-i.left)/e.clientWidth*2-1,n.y=-((s.clientY-i.top)/e.clientHeight)*2+1,this.raycaster.setFromCamera(n,this.camera);const o=this.raycaster.intersectObjects(this.scene.children,!0);o.length>0&&console.log(">>>",o)})}animate(){requestAnimationFrame(this.animate.bind(this));for(let e=0;e<this.sceneComponents.length;e++)this.sceneComponents[e].update(this.scene);this.controls&&this.controls.update(),this.renderer&&this.renderer.render(this.scene,this.camera)}getSatelliteStore(){return this.satelliteStore}getSatelliteGroups(){return this.satelliteGroups}zoomIn(){this.camera&&(this.camera.zoom+=.1,this.camera.updateProjectionMatrix())}zoomOut(){this.camera&&(this.camera.zoom-=.1,this.camera.updateProjectionMatrix())}setHoverSatellite(e){var t,s;(t=this.satellites)==null||t.setHoverSatellite(e),(s=this.orbits)==null||s.setHoverSatellite(e)}setSelectedSatellite(e){var t,s;(t=this.satellites)==null||t.setSelectedSatellite(e),(s=this.orbits)==null||s.setSelectedSatellite(e)}setSelectedSatelliteGroup(e){var t,s;(t=this.satelliteGroups)==null||t.selectGroup(e),(s=this.orbits)==null||s.setSatelliteGroup(e)}getSelectedSatellite(){if(this.satelliteStore)return this.satelliteStore.getSatellite(this.selectedSatelliteIdx)}getSelectedSatelliteIdx(){return this.selectedSatelliteIdx}addEventListener(e,t){this.eventManager.addEventListener(e,t)}}function Re(a){return new Me(a)}const B={satMovementChange:"satMovementChange",selectedSatChange:"selectedSatChange",satHover:"sathover",satDataLoaded:"satdataloaded",closeWindow:"closeWindow",cruncherReady:"cruncherReady"};class Pe{constructor(e,t={}){r(this,"element");r(this,"id");r(this,"options");r(this,"listeners",{});r(this,"firstOpen",!0);r(this,"windowManager");this.element=document.querySelector(`#${e}`),this.id=e,this.options=t,this.listeners={},this.firstOpen=!0,this.initEvents()}setWindowManager(e){this.windowManager=e}open(){this.element&&(this.firstOpen=!1,this.element.classList.add("active"),this.element.classList.add("visible"),this.element.classList.remove("hidden"),this.windowManager.bringWindowToFront(this))}close(){this.element&&(this.element.classList.remove("active"),this.element.classList.remove("visible"),this.element.classList.add("hidden"))}isOpen(){return this.element?this.element.classList.contains("visible"):!1}initEvents(){if(!this.element)return;const e=this.element.querySelector(".window-close");e&&e.addEventListener("click",()=>{this.close()})}moveTo(e,t){this.element&&(this.element.style.top=`${t}px`,this.element.style.left=`${e}px`)}getLocation(){if(!this.element)return{x:0,y:0};const e=this.element.style;return e.x?{x:e.x,y:e.y}:{x:this.element.offsetLeft,y:this.element.offsetTop}}addEventListener(e,t){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e])this.listeners[e].add(t);else throw new Error("unknown event")}fireEvent(e,t){this.listeners[e]&&this.listeners[e].forEach(i=>{i(t)})}}const We=100;class $e{constructor(){r(this,"windows",[]);r(this,"windowsById",{});r(this,"initialOpen",!1)}bringWindowToFront(e){const t=e.element;let s=-1;for(let i=0;i<this.windows.length;i++)if(this.windows[i].id===(t==null?void 0:t.id)){s=i;break}s>-1&&(this.windows.splice(s,1),this.windows.push(e));for(let i=0;i<this.windows.length;i++){const n=this.windows[i];n&&n.element&&n.element.style&&(n.element.style.zIndex=We+i+1)}}registerWindow(e,t={}){const s=new Pe(e,t);s.setWindowManager(this),this.windows.push(s),this.windowsById[e]=s,this.makeDraggable(s)}getTopWindow(){for(let e=this.windows.length-1;e>=0;e--)if(this.windows[e].isOpen())return this.windows[e]}openWindow(e){const s={x:100,y:100},i=this.windowsById[e],n=this.getTopWindow();let o=!1;if(i){let{x:d,y:l}=i.getLocation();if(n||(d=s.x,l=s.y,this.initialOpen=!1),o=i.firstOpen,o&&n){const h=n.getLocation();h&&(d=h.x+42,l=h.y+42)}if(i.open(),!this.initialOpen&&!o){const h=i.getLocation();h&&(d=h.x,l=h.y)}(d>window.innerWidth||d<0)&&(d=s.x),(l>window.innerHeight||l<0)&&(l=s.y),this.bringWindowToFront(i),i.moveTo(d,l),this.initialOpen=!1}}closeWindow(e){const t=this.windowsById[e];t&&t.close()}makeDraggable(e){let t=0,s=0,i=0,n=0;const o=e.element;if(!o)return;const d=o.querySelector(".drag-zone")||o;function l(h){const u=`${t-(n-h.clientY)}px`,v=`${s-(i-h.clientX)}px`;o&&o.style&&(o.style.top=u,o.style.left=v)}o.classList.add("draggable"),o.addEventListener("click",()=>{this.bringWindowToFront(e)}),d.addEventListener("mousedown",h=>{h.preventDefault(),s=o.offsetLeft,t=o.offsetTop,i=h.clientX,n=h.clientY,this.bringWindowToFront(e),o.style.right="unset",o.style.bottom="unset",o.style.left=`${s}px`,o.style.top=`${t}px`,o.classList.add("dragging"),d.addEventListener("mousemove",l)}),o.addEventListener("mouseup",h=>{h.preventDefault(),d.removeEventListener("mousemove",l),o.classList.remove("dragging")}),o.addEventListener("mouseout",h=>{h.preventDefault(),d.removeEventListener("mousemove",l),o.classList.remove("dragging")})}}const z=200;let f,C,X=!1,M=-1,I=!1,Z;function Q(){return I}function Be(){return Z}function ze(){return I?document.querySelector("#search").value:null}function je(){return X}function Ue(){return M}function Fe(){X=!1,M=-1,f.setHoverSatellite(M)}function A(a){const e=document.querySelector("#search-results");e&&(a?e.style.display="block":e.style.display="none",I=a)}function qe(){A(!Q())}function Ve(){A(!0)}function ee(){A(!1);const a=f.getSatelliteGroups();a&&a.clearSelect()}function te(a,e){const t=document.querySelector("#search-results"),s=f.getSatelliteStore();if(!s)return;let i="";for(let n=0;n<a.length;n++){if(a[n].satId===void 0)continue;const o=s.getSatellite(a[n].satId);if(!o){p.warn("satellite not found",a[n].satId);continue}i+=`<div class="search-result" data-sat-id="${o.id}">`,a[n].isIntlDes?i+=o.OBJECT_NAME:(i+=o.OBJECT_NAME.substring(0,a[n].strIndex),i+='<span class="search-hilight">',i+=o.OBJECT_NAME.substring(a[n].strIndex,a[n].strIndex+e.length),i+="</span>",i+=o.OBJECT_NAME.substring(a[n].strIndex+e.length)),i+='<div class="search-result-intldes">',a[n].isIntlDes?(i+=o.intlDes.substring(0,a[n].strIndex),i+='<span class="search-hilight">',i+=o.intlDes.substring(a[n].strIndex,a[n].strIndex+e.length),i+="</span>",i+=o.intlDes.substring(a[n].strIndex+e.length)):i+=o.intlDes,i+="</div></div>"}t.innerHTML=i,t.style.display="block",I=!0}function Ne(){const a=document.querySelector("#search-results");a&&(a.innerHTML="")}function R(a){var d;const e=f.getSatelliteStore();if(!e)return;const t=e.getSatData();if(f.setSelectedSatellite(-1),a.length===0){ee();return}a=a.toUpperCase();const s=[];for(let l=0;l<t.length;l++)((d=t[l])==null?void 0:d.OBJECT_NAME.indexOf(a))!==-1&&s.push({isIntlDes:!1,strIndex:t[l].OBJECT_NAME.indexOf(a),satId:l}),t[l].intlDes&&t[l].intlDes.indexOf(a)!==-1&&(console.log(t[l]),s.push({isIntlDes:!0,strIndex:t[l].intlDes.indexOf(a),satId:l}));s.length>z&&(s.length=z);const i=[];for(let l=0;l<s.length;l++)i.push(s[l].satId);const n=new K("search-results","Search Results","idList",i,e);n.reload(),Z=n;const o=f.getSatelliteGroups();o&&o.selectGroup(n),te(s,a)}function He(){var e,t;const a=document.querySelector("#search-results");a&&(a.addEventListener("click",s=>{const n=s.target.dataset.satId;Fe(),f.setSelectedSatellite(n)}),(e=document.querySelector("#search"))==null||e.addEventListener("input",()=>{var i;const s=(i=document.querySelector("#search"))==null?void 0:i.value;R(s)}),(t=document.querySelector("#all-objects-link"))==null||t.addEventListener("click",()=>{const s=f.getSelectedSatellite();if(s){const n=s.intlDes.slice(0,8);R(n),document.querySelector("#search").value=n,C&&C.openWindow("search-window")}}))}function Je(a,e){f=a,C=e,He()}const w={init:Je,clearResults:Ne,getHoverSat:Ue,isHovering:je,showResults:Ve,hideResults:ee,doSearch:R,getCurrentSearch:ze,getLastResultGroup:Be,fillResultBox:te,isResultBoxOpen:Q,setResultsVisible:A,toggleResultsVisible:qe},_e=[],g=new $e,Ke=[];let j=!1,c;function se(a){var e,t;a?(e=document.querySelector("body"))==null||e.classList.add("loading"):(t=document.querySelector("body"))==null||t.classList.remove("loading")}function Ye(){const a=document.querySelector("#groups-display"),e=c.getSatelliteGroups();let t=[];e&&(t=e.asArray().sort((i,n)=>i.name.localeCompare(n.name)));let s="";for(let i=0;i<t.length;i++)s+=`<li data-group="${t[i].id}" id="satgroup-${t[i].id}" class="clickable">${t[i].name}</li>
`;a.innerHTML=s}function U(a,e){const t=document.querySelector(a);t&&(t.innerHTML=e)}function Xe(){var e;(e=document.querySelector("#groups-display"))==null||e.addEventListener("mouseout",()=>{if(!j){const t=c.getSatelliteGroups();t&&(w.isResultBoxOpen()?t.selectGroup(w.getLastResultGroup()):t.clearSelect())}});const a=document.querySelectorAll("#groups-display>li");for(let t=0;t<a.length;t++){const s=a[t];s.addEventListener("mouseover",i=>{const o=i.currentTarget.dataset.group,d=c.getSatelliteGroups();d&&d.selectGroup(d.getGroupById(o))}),s.addEventListener("mouseout",()=>{const i=c.getSatelliteGroups();if(i){const n=document.querySelector("#groups-display>li.selected");n?i.selectGroup(i.getGroupById(n.dataset.group)):i.selectGroup(void 0)}}),s.addEventListener("click",i=>{i.preventDefault();const n=i.currentTarget;j=!0;const o=document.querySelector("#groups-display>li.selected");let d;o&&(d=o.dataset.group),console.dir(i.target);for(let v=0;v<a.length;v++)a[v].classList.remove("selected");const l=c.getSatelliteGroups(),h=n.dataset.group;let u;h===d?(l&&l.clearSelect(),w.clearResults(),w.hideResults()):(i.preventDefault(),i.stopPropagation(),l&&(c.setSelectedSatellite(-1),l&&(u=l.getGroupById(h)),u&&(n.classList.add("selected"),w.fillResultBox(u.sats,""),g.openWindow("search-window"),u.reload()))),l&&(l.selectGroup(u),c.setSelectedSatelliteGroup(u))})}}function Ze(){var e,t;const a=c.getSatelliteGroups();a==null||a.reloadGroups(),(e=document.querySelector("#zoom-in"))==null||e.addEventListener("click",s=>{s.preventDefault(),c.zoomIn()}),(t=document.querySelector("#zoom-out"))==null||t.addEventListener("click",s=>{s.preventDefault(),c.zoomOut()}),window.addEventListener("resize",()=>{Ke.forEach(s=>{window.visualViewport&&(s.offsetLeft+s.offsetWidth>window.visualViewport.width&&(s.style.right="unset",s.style.left=`${window.visualViewport.width-s.offsetWidth}px`),s.offsetTop+s.offsetHeight>window.visualViewport.height&&(s.style.bottom="unset",s.style.offsetTop=`${window.visualViewport.height-s.offsetHeight}px`))})}),se(!1)}function Qe(a){a.satId&&(U("#sat-altitude",`${a.altitude.toFixed(2)} km`),U("#sat-velocity",`${a.velocity.toFixed(2)} km/s`))}function F(){Ze(),Ye(),setTimeout(()=>Xe(),0);const a=document.querySelector("#load-cover");a&&a.classList.add("hidden")}function et(){return _e}function tt(){const a=document.querySelectorAll(".menu-item");for(let e=0;e<a.length;e++){const t=a[e];t.addEventListener("click",()=>{const s=t.dataset.action;if(s&&s.startsWith("open:")){const i=s.split(":");g.openWindow(i[1])}})}}function st(){return w.getCurrentSearch()}function it(a){c=a,g.registerWindow("sat-infobox"),g.registerWindow("about-window"),g.registerWindow("help-window"),g.registerWindow("groups-window"),g.registerWindow("search-window"),w.init(c,g),tt(),c.addEventListener(B.satMovementChange,Qe),c.ready?F():c.addEventListener(B.satDataLoaded,F)}const rt={setLoading:se,init:it,getSupportedEvents:et,getCurrentSearch:st};async function at(){const a=Re(J);await a.init(),a.animate(),rt.init(a)}at().catch(a=>console.error(a));
